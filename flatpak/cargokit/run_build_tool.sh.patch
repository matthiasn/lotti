diff --git a/run_build_tool.sh b/run_build_tool.sh
index 0e2c973..200b520 100755
--- a/run_build_tool.sh
+++ b/run_build_tool.sh
@@
-#!/bin/bash
-
-set -e
+#!/bin/bash
+
+# Flatpak: use rust-stable SDK and block network/downloads
+export PATH="/usr/lib/sdk/rust-stable/bin:$PATH"
+export CARGO="/usr/lib/sdk/rust-stable/bin/cargo"
+export RUSTC="/usr/lib/sdk/rust-stable/bin/rustc"
+export CARGO_HOME="${CARGO_HOME:-/run/build/lotti/.cargo}"
+export CARGO_NET_OFFLINE=true
+export RUSTUP_HOME="/usr/lib/sdk/rust-stable"
+export CARGOKIT_ALLOW_DOWNLOADS=false
+export CARGOKIT_OFFLINE=true
+export BUILD_TOOL_ALLOW_DOWNLOADS=false
+export CARGOKIT_USE_PRECOMPILED=false
+
+# rustup shim (cargokit checks for rustup presence)
+SHIM_DIR="${CARGOKIT_TOOL_TEMP_DIR:-${TMPDIR:-/tmp}}/cargokit-shims"
+mkdir -p "$SHIM_DIR"
+cat >"$SHIM_DIR/rustup" <<'EOF'
+#!/bin/sh
+if [ "$1" = "--version" ] || [ "$1" = "show" ]; then
+  echo "rustup (shim) using system rust-stable"
+  exit 0
+fi
+exit 0
+EOF
+chmod +x "$SHIM_DIR/rustup"
+export PATH="$SHIM_DIR:$PATH"
+
+set -e
@@
-    "$DART" pub get --no-precompile
+    "$DART" pub get --no-precompile --offline
     "$DART" compile kernel bin/build_tool_runner.dart
     echo "$PACKAGE_HASH" > "$PACKAGE_HASH_FILE"
 fi
@@
-  "$DART" pub get --no-precompile
+  "$DART" pub get --no-precompile --offline
   "$DART" compile kernel bin/build_tool_runner.dart
   "$DART" bin/build_tool_runner.dill "$@"
   exit_code=$?
