diff --git a/run_build_tool.sh b/run_build_tool.sh
index 0e2c973..200b520 100755
--- a/run_build_tool.sh
+++ b/run_build_tool.sh
@@ -1,5 +1,9 @@
 #!/bin/bash

+# Flatpak: ensure Rust SDK extension is in PATH
+export PATH="/usr/lib/sdk/rust-stable/bin:$PATH"
+export CARGO="/usr/lib/sdk/rust-stable/bin/cargo"
+export RUSTC="/usr/lib/sdk/rust-stable/bin/rustc"
+export CARGO_HOME="${CARGO_HOME:-/run/build/lotti/.cargo}"
+export CARGO_NET_OFFLINE=true
+export RUSTUP_HOME="/usr/lib/sdk/rust-stable"
+export CARGOKIT_ALLOW_DOWNLOADS=false
+export CARGOKIT_OFFLINE=true
+# If rustup is unavailable in the SDK, stub it; we rely on the preinstalled Rust toolchain.
+if ! command -v rustup >/dev/null 2>&1; then
+  echo "Using system Rust toolchain (rustup not present in SDK)" >&2
+  rustup() { true; }
+fi
+
 set -e

 BASEDIR=$(dirname "$0")
@@ -66,7 +70,7 @@ fi

 # Run pub get if needed.
 if [ ! -f "$PACKAGE_HASH_FILE" ]; then
-    "$DART" pub get --no-precompile
+    "$DART" pub get --no-precompile --offline
     "$DART" compile kernel bin/build_tool_runner.dart
     echo "$PACKAGE_HASH" > "$PACKAGE_HASH_FILE"
 fi
@@ -79,7 +83,7 @@ exit_code=$?

 # 253 means invalid snapshot version.
 if [ $exit_code == 253 ]; then
-  "$DART" pub get --no-precompile
+  "$DART" pub get --no-precompile --offline
   "$DART" compile kernel bin/build_tool_runner.dart
   "$DART" bin/build_tool_runner.dill "$@"
   exit_code=$?
